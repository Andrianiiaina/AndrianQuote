import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import '../models/quote_model.dart';
import '../widgets/style.dart';
import 'package:flutter_carousel_widget/flutter_carousel_widget.dart';

class ShowQuotea extends StatefulWidget {
  final int idQuote;
  const ShowQuotea({Key? key, required this.idQuote}) : super(key: key);

  @override
  State<ShowQuotea> createState() => _ShowQuoteState();
}

class _ShowQuoteState extends State<ShowQuotea> {
  late int idQuote;
  late QuotyClass? quote;

  ScrollController scrollC = ScrollController();
  bool showbtn = false;
  @override
  void initState() {
    super.initState();
    _initState();
    scrollC.addListener(() {
      double shoxoffset = 10.0;
      if (scrollC.offset > shoxoffset) {
        showbtn = true;
        setState(() {});
      } else {
        showbtn = false;
        setState(() {});
      }
    });
  }

  _initState() {
    idQuote = widget.idQuote;
    quote = QuoteModel.getQuote(idQuote);
  }

  _delete(int index) async {
    await QuoteModel.deleteQuote(index);
    showMessage(context, "Le quote a bien été supprimé.");
    context.go('/');
  }

  @override
  Widget build(BuildContext context) {
    return ExpandableCarousel.builder(
      itemCount: 15,
      options: CarouselOptions(
        // autoPlay: true,
        initialPage: idQuote,
        //autoPlayInterval: const Duration(seconds: 2),
      ),
      itemBuilder: (BuildContext context, int itemIndex, int pageViewIndex) {
        final quote = quotes[itemIndex];
        return Scaffold(
          appBar: AppBar(
            automaticallyImplyLeading: false,
            title: Text(" {quote['books']}",
                style: const TextStyle(
                  fontSize: 14,
                )),
            actions: [
              IconButton(
                  onPressed: () {
                    // setState(() {
                    //  showForm(context, QuoteFormulaire(id: widget.idQuote));
                    // });
                  },
                  icon: const Icon(Icons.edit)),
              IconButton(
                  onPressed: () {
                    ShowConfirmation(context, "Confirmation",
                        "Etes-vous sur de vouloir supprimer ce livre?", () {
                      // _delete(idQuote);
                    });
                  },
                  icon: const Icon(Icons.delete))
            ],
          ),
          body: Container(
            width: MediaQuery.of(context).size.width,
            height: MediaQuery.of(context).size.height,
            padding: const EdgeInsets.fromLTRB(20, 10, 20, 0),
            alignment: Alignment.center,
            // decoration: BoxDecoration(
            // image: DecorationImage(
            // image: AssetImage(quote!.fond),
            // fit: BoxFit.cover,
            //opacity: 0.7),
            //),
            child: SingleChildScrollView(
              scrollDirection: Axis.vertical,
              // controller: scrollC,
              child: Column(
                children: [
                  Text(
                    "quote!.quote",
                    textAlign: TextAlign.start,
                    style: const TextStyle(
                        color: Colors.white,
                        fontSize: 16,
                        fontWeight: FontWeight.bold),
                  ),
                  const SizedBox(height: 10),
                  Text(
                    "${"quote!.author"} - ${"quote!.book"}",
                    style: const TextStyle(
                        fontWeight: FontWeight.bold,
                        fontSize: 12,
                        color: Colors.white,
                        fontStyle: FontStyle.italic),
                  ),
                ],
              ),
            ),
          ),
        );
      },
    );
  }
}
/**Scaffold(
      appBar: AppBar(
        automaticallyImplyLeading: false,
        title: Text(" ${quote!.book}",
            style: const TextStyle(
              fontSize: 14,
            )),
        actions: [
          IconButton(
              onPressed: () {
                setState(() {
                  showForm(context, QuoteFormulaire(id: widget.idQuote));
                });
              },
              icon: const Icon(Icons.edit)),
          IconButton(
              onPressed: () {
                ShowConfirmation(context, "Confirmation",
                    "Etes-vous sur de vouloir supprimer ce livre?", () {
                  _delete(idQuote);
                });
              },
              icon: const Icon(Icons.delete))
        ],
      ),
      floatingActionButton: AnimatedOpacity(
          opacity: showbtn ? 1.0 : 0.0,
          duration: const Duration(milliseconds: 1000),
          child: FloatingActionButton.small(
            backgroundColor: Colors.grey,
            onPressed: () {
              scrollC.animateTo(0,
                  duration: const Duration(milliseconds: 500),
                  curve: Curves.fastOutSlowIn);
            },
            child: const Icon(
              Icons.arrow_upward,
            ),
          )),
      body: Container(
        width: MediaQuery.of(context).size.width,
        height: MediaQuery.of(context).size.height,
        padding: const EdgeInsets.fromLTRB(20, 10, 20, 0),
        alignment: Alignment.center,
        decoration: BoxDecoration(
          image: DecorationImage(
              image: AssetImage(quote!.fond), fit: BoxFit.cover, opacity: 0.7),
        ),
        child: SingleChildScrollView(
          scrollDirection: Axis.vertical,
          controller: scrollC,
          child: Column(
            children: [
              Text(
                quote!.quote,
                textAlign: TextAlign.start,
                style: const TextStyle(
                    color: Colors.white,
                    fontSize: 16,
                    fontWeight: FontWeight.bold),
              ),
              const SizedBox(height: 10),
              Text(
                "${quote!.author} - ${quote!.book}",
                style: const TextStyle(
                    fontWeight: FontWeight.bold,
                    fontSize: 12,
                    color: Colors.white,
                    fontStyle: FontStyle.italic),
              ),
            ],
          ),
        ),
      ),
    ); */